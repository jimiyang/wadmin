{"remainingRequest":"/Users/yanglina/wadmin/node_modules/_babel-loader@8.0.6@babel-loader/lib/index.js!/Users/yanglina/wadmin/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js??ref--0-0!/Users/yanglina/wadmin/node_modules/_vue-loader@15.7.2@vue-loader/lib/index.js??vue-loader-options!/Users/yanglina/wadmin/src/view/module/system/app/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yanglina/wadmin/src/view/module/system/app/index.vue","mtime":1576491097381},{"path":"/Users/yanglina/wadmin/.babelrc","mtime":1576127290134},{"path":"/Users/yanglina/wadmin/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yanglina/wadmin/node_modules/_babel-loader@8.0.6@babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yanglina/wadmin/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yanglina/wadmin/node_modules/_vue-loader@15.7.2@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//import {getApps, updateApp, addApp, removeApp, getAppClientInfo, updateAppClientInfo, restApp} from '@/api/app'\nimport { startWith, listConvertGroup } from '@/libs/util';\nexport default {\n  name: 'SystemApp',\n\n  data() {\n    const validateEn = (rule, value, callback) => {\n      let reg = /^[-_a-zA-Z0-9]+$/;\n\n      if (value === '') {\n        callback(new Error('英文不能为空'));\n      } else if (value !== '' && !reg.test(value)) {\n        callback(new Error('只允许字母、数字、下划线、横线'));\n      } else {\n        callback();\n      }\n    };\n\n    return {\n      loading: false,\n      saving: false,\n      current: 'form1',\n      forms: ['form1', 'form2', 'form3'],\n      selectApis: [],\n      selectUsers: [],\n      selectGrantTypes: [{\n        label: 'authorization_code',\n        title: '授权码模式',\n        desc: 'Web服务端应用与第三方移动App应用'\n      }, {\n        label: 'client_credentials',\n        title: '客户端模式',\n        desc: '没有用户参与的,内部服务端与第三方服务端'\n      }, {\n        label: 'password',\n        title: '密码模式',\n        desc: '内部Web网页应用与内部移动App应用'\n      }, {\n        label: 'implicit',\n        title: '简化模式',\n        desc: 'Web网页应用或第三方移动App应用'\n      }, {\n        label: 'refresh_token',\n        title: '刷新令牌',\n        desc: '刷新并延迟访问令牌时长'\n      }],\n      selectScopes: [{\n        label: 'userProfile',\n        title: '允许访问基本信息'\n      }, // 这是测试数据,自定义对应接口权限标识\n      {\n        label: 'api1',\n        title: '允许访问....自定义信息'\n      }],\n      pageInfo: {\n        total: 0,\n        page: 1,\n        limit: 10,\n        appId: '',\n        appName: '',\n        appNameEn: ''\n      },\n      defaultList: [{\n        'name': '',\n        'url': ''\n      }],\n      modalVisible: false,\n      modalTitle: '',\n      imgName: '',\n      visible: false,\n      uploadList: [],\n      formItemRules: {\n        website: [{\n          type: 'url',\n          message: '请输入有效网址',\n          trigger: 'blur'\n        }],\n        appType: [{\n          required: true,\n          message: '应用类型不能为空',\n          trigger: 'blur'\n        }],\n        appOs: [{\n          required: true,\n          message: '操作系统不能为空',\n          trigger: 'blur'\n        }],\n        redirectUrls: [{\n          required: true,\n          message: '授权重定向地址不能为空',\n          trigger: 'blur'\n        }],\n        appName: [{\n          required: true,\n          message: '应用名称不能为空',\n          trigger: 'blur'\n        }],\n        appNameEn: [{\n          required: true,\n          validator: validateEn,\n          trigger: 'blur'\n        }],\n        grantTypes: [{\n          required: true,\n          type: 'array',\n          min: 1,\n          message: '授权类型不能为空',\n          trigger: 'blur'\n        }],\n        scopes: [{\n          required: true,\n          type: 'array',\n          min: 1,\n          message: '用户授权范围不能为空',\n          trigger: 'blur'\n        }],\n        accessTokenValidity: [{\n          required: true,\n          type: 'integer',\n          min: 900,\n          message: '访问令牌有效期不能少于900',\n          trigger: 'blur'\n        }],\n        refreshTokenValidity: [{\n          required: true,\n          type: 'integer',\n          min: 900,\n          message: '刷新令牌有效期不能少于900',\n          trigger: 'blur'\n        }]\n      },\n      formItem: {\n        appId: '',\n        apiKey: '',\n        secretKey: '',\n        appName: '',\n        appNameEn: '',\n        appType: 'server',\n        appIcon: '',\n        appOs: '',\n        path: '',\n        website: '',\n        appDesc: '',\n        status: 1,\n        redirectUrls: '',\n        developerId: '',\n        scopes: ['userProfile'],\n        autoApproveScopes: [],\n        authorities: [],\n        grantTypes: [],\n        accessTokenValidity: 43200,\n        refreshTokenValidity: 2592000,\n        expireTime: '',\n        isExpired: false,\n        tokenValidity: '1'\n      },\n      columns: [{\n        type: 'selection',\n        width: 60,\n        align: 'center'\n      }, {\n        title: '应用名称',\n        key: 'appName',\n        width: 200\n      }, {\n        title: 'AppId',\n        key: 'appId',\n        width: 200\n      }, {\n        title: 'ApiKey',\n        key: 'apiKey',\n        width: 250\n      }, {\n        title: 'SecretKey',\n        key: 'secretKey',\n        width: 300\n      }, {\n        title: '开发者',\n        key: 'userName',\n        width: 200\n      }, {\n        title: '应用类型',\n        slot: 'appType',\n        width: 180,\n        filters: [{\n          label: '服务器应用',\n          value: 0\n        }, {\n          label: '手机应用',\n          value: 1\n        }, {\n          label: 'PC网页应用',\n          value: 2\n        }, {\n          label: '手机网页应用',\n          value: 3\n        }],\n        filterMultiple: false,\n\n        filterMethod(value, row) {\n          if (value === 0) {\n            return row.appType === 'server';\n          } else if (value === 1) {\n            return row.appType === 'app';\n          } else if (value === 2) {\n            return row.appType === 'pc';\n          } else if (value === 3) {\n            return row.appType === 'wap';\n          }\n        }\n\n      }, {\n        title: '状态',\n        slot: 'status',\n        key: 'status'\n      }, {\n        title: '操作',\n        slot: 'action',\n        fixed: 'right',\n        width: 120\n      }],\n      data: []\n    };\n  },\n\n  methods: {\n    handleModal(data) {\n      if (data) {\n        this.formItem = Object.assign({}, this.formItem, data);\n        this.formItem.appId = data.appId;\n      }\n\n      if (this.current === this.forms[0]) {\n        this.modalTitle = data ? '编辑应用 - ' + data.appName : '添加应用';\n        this.handleLoadUsers();\n      }\n\n      if (this.current === this.forms[1]) {\n        this.modalTitle = data ? '开发信息 - ' + data.appName : '开发信息';\n        this.handleLoadAppClientInfo(this.formItem.apiKey);\n      }\n\n      if (this.current === this.forms[2]) {\n        this.modalTitle = data ? '分配权限 - ' + data.appName : '分配权限';\n        this.handleLoadAppGranted(this.formItem.appId);\n      }\n\n      this.formItem.status = this.formItem.status + '';\n    },\n\n    handleResetForm(form) {\n      this.$refs[form].resetFields();\n    },\n\n    handleReset() {\n      //重置验证\n      const newData = {\n        appId: '',\n        apiKey: '',\n        secretKey: '',\n        appName: '',\n        appNameEn: '',\n        appType: 'server',\n        appIcon: '',\n        appOs: '',\n        path: '',\n        website: '',\n        appDesc: '',\n        status: 1,\n        redirectUrls: '',\n        developerId: '',\n        scopes: ['userProfile'],\n        autoApproveScopes: [],\n        authorities: [],\n        grantTypes: [],\n        accessTokenValidity: 43200,\n        refreshTokenValidity: 2592000,\n        expireTime: '',\n        isExpired: false,\n        tokenValidity: '1'\n      };\n      this.formItem = newData;\n      this.forms.map(form => {\n        this.handleResetForm(form);\n      });\n      this.current = this.forms[0];\n      this.saving = false;\n      this.modalVisible = false;\n    },\n\n    handleSubmit() {\n      if (this.current === this.forms[0]) {\n        this.$refs[this.current].validate(valid => {\n          if (valid) {\n            this.saving = true;\n            const data = Object.assign({}, this.formItem);\n\n            if (data.appId) {} else {}\n          }\n        });\n      }\n\n      if (this.current === this.forms[1]) {\n        this.$refs[this.current].validate(valid => {\n          if (valid) {\n            this.saving = true;\n\n            if (this.formItem.tokenValidity === '0') {\n              this.formItem.accessTokenValidity = -1;\n              this.formItem.refreshTokenValidity = -1;\n            }\n          }\n        });\n      }\n\n      if (this.current === this.forms[2]) {\n        this.$refs[this.current].validate(valid => {\n          if (valid) {\n            this.saving = true;\n          }\n        });\n      }\n    },\n\n    handleSearch(page) {\n      if (page) {\n        this.pageInfo.page = page;\n      }\n\n      this.loading = true;\n    },\n\n    handleRemove(data) {\n      this.$Modal.confirm({\n        title: '删除后将无法恢复,确定删除吗？',\n        onOk: () => {}\n      });\n    },\n\n    handleResetSecret(data) {\n      this.$Modal.confirm({\n        title: '重置后将影响应用正常使用,确定重置吗？',\n        onOk: () => {}\n      });\n    },\n\n    handleTabClick(name) {\n      this.current = name;\n      this.handleModal();\n    },\n\n    handleClick(name, row) {\n      switch (name) {\n        case 'remove':\n          this.handleRemove(row);\n          break;\n\n        case 'resetSecret':\n          this.handleResetSecret(row);\n          break;\n      }\n    },\n\n    handleOnAppTypeChange(data) {\n      if (data !== 'app') {\n        this.formItem.appOs = '';\n      } else {\n        if (!this.formItem.appOs) {\n          this.formItem.appOs = 'ios';\n        }\n      }\n    },\n\n    handleOnSelectUser(data) {\n      this.formItem.developerId = data.userId;\n    },\n\n    handlePage(current) {\n      this.pageInfo.page = current;\n      this.handleSearch();\n    },\n\n    handlePageSize(size) {\n      this.pageInfo.limit = size;\n      this.handleSearch();\n    },\n\n    handleLoadAppGranted(appId) {\n      if (!appId) {\n        return;\n      }\n\n      const that = this;\n      const p1 = getAuthorityApi('');\n      const p2 = getAuthorityApp(appId);\n    },\n\n    handleLoadAppClientInfo(clientId) {\n      if (!clientId) {\n        return;\n      }\n    },\n\n    transferRender(item) {\n      return `<span  title=\"${item.label}\">${item.label}</span>`;\n    },\n\n    handleTransferChange(newTargetKeys, direction, moveKeys) {\n      if (newTargetKeys.indexOf('1') != -1) {\n        this.formItem.authorities = ['1'];\n      } else {\n        this.formItem.authorities = newTargetKeys;\n      }\n    },\n\n    handleLoadUsers() {},\n\n    handleView(name) {\n      this.imgName = name;\n      this.visible = true;\n    },\n\n    handleRemoveImg(file) {\n      const fileList = this.$refs.upload.fileList;\n      this.$refs.upload.fileList.splice(fileList.indexOf(file), 1);\n    },\n\n    handleSuccess(res, file) {\n      file.url = '';\n      file.name = '';\n    },\n\n    handleFormatError(file) {\n      this.$Message.warning('图片支持png、jpg、jpeg');\n    },\n\n    handleMaxSize(file) {\n      this.$Message.warning('图片大小不能超过2M.');\n    },\n\n    handleBeforeUpload() {\n      const check = this.uploadList.length < 1;\n\n      if (!check) {\n        this.$Message.warning('只能上传一张.');\n      }\n\n      return check;\n    }\n\n  },\n  mounted: function () {\n    this.handleSearch();\n  }\n};",{"version":3,"sources":["index.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div>\n    <Card shadow>\n      <Form ref=\"searchForm\"\n            :model=\"pageInfo\"\n            inline\n            :label-width=\"80\">\n        <FormItem label=\"AppId\" prop=\"appId\">\n          <Input type=\"text\" v-model=\"pageInfo.appId\" placeholder=\"请输入关键字\"/>\n        </FormItem>\n        <FormItem label=\"中文名称\" prop=\"appName\">\n          <Input type=\"text\" v-model=\"pageInfo.appName\" placeholder=\"请输入关键字\"/>\n        </FormItem>\n        <FormItem label=\"英文名称\" prop=\"appName\">\n          <Input type=\"text\" v-model=\"pageInfo.appNameEn\" placeholder=\"请输入关键字\"/>\n        </FormItem>\n        <FormItem>\n          <Button type=\"primary\" @click=\"handleSearch(1)\">查询</Button>&nbsp;\n          <Button @click=\"handleResetForm('searchForm')\">重置</Button>\n        </FormItem>\n      </Form>\n      <div class=\"search-con search-con-top\">\n        <ButtonGroup>\n          <Button :disabled=\"hasAuthority('systemAppEdit')?false:true\" class=\"search-btn\" type=\"primary\"\n                  @click=\"handleModal()\">\n            <span>添加</span>\n          </Button>\n        </ButtonGroup>\n      </div>\n      <Alert type=\"info\" show-icon>客户端模式,请授权相关接口资源。否则请求网关服务器将提示<code>\"权限不足,拒绝访问!\"</code></Alert>\n      <Table border :columns=\"columns\" :data=\"data\" :loading=\"loading\">\n        <template slot=\"status\" slot-scope=\"{ row }\">\n          <Badge v-if=\"row.status===1\" status=\"success\" text=\"上线\"/>\n          <Badge v-else=\"\" status=\"error\" text=\"下线\"/>\n        </template>\n        <template slot=\"appType\" slot-scope=\"{ row }\">\n          <Tag color=\"blue\" v-if=\"row.appType==='server'\">服务器应用</Tag>\n          <Tag color=\"blue\" v-else-if=\"row.appType==='app'\">手机应用</Tag>\n          <Tag color=\"blue\" v-else-if=\"row.appType==='pc'\">PC网页应用</Tag>\n          <Tag color=\"blue\" v-else=\"\">手机网页应用</Tag>\n        </template>\n        <template slot=\"action\" slot-scope=\"{ row }\">\n          <a @click=\"handleModal(row)\" :disabled=\"row.appId != 'gateway' && hasAuthority('systemAppEdit') ?false:true\">\n            编辑</a>&nbsp;\n          <Dropdown v-show=\"hasAuthority('systemAppEdit')\" transfer ref=\"dropdown\" @on-click=\"handleClick($event,row)\">\n            <a href=\"javascript:void(0)\" :disabled=\"row.appId === 'gateway' ?true:false\">\n              <span>更多</span>\n              <Icon type=\"ios-arrow-down\"></Icon>\n            </a>\n            <DropdownMenu slot=\"list\">\n              <DropdownItem name=\"resetSecret\">重置密钥</DropdownItem>\n              <DropdownItem name=\"remove\">删除应用</DropdownItem>\n            </DropdownMenu>\n          </Dropdown>\n        </template>\n      </Table>\n      <Page transfer :total=\"pageInfo.total\" :current=\"pageInfo.page\" :page-size=\"pageInfo.limit\" show-elevator\n            show-sizer\n            show-total\n            @on-change=\"handlePage\" @on-page-size-change='handlePageSize'></Page>\n    </Card>\n\n    <Modal v-model=\"modalVisible\"\n           :title=\"modalTitle\"\n           width=\"40\"\n           @on-cancel=\"handleReset\">\n      <div>\n        <Tabs :value=\"current\" @on-click=\"handleTabClick\">\n          <TabPane label=\"应用信息\" name=\"form1\">\n            <Form ref=\"form1\" v-show=\"current=='form1'\" :model=\"formItem\" :rules=\"formItemRules\" :label-width=\"135\">\n              <FormItem label=\"应用图标\">\n                <div class=\"upload-list\" v-for=\"(item, index) in uploadList\" :key=\"index\">\n                  <template v-if=\"item.status === 'finished'\">\n                    <img :src=\"item.url\">\n                    <div class=\"upload-list-cover\">\n                      <Icon type=\"ios-eye-outline\" @click.native=\"handleView(item.name)\"></Icon>\n                      <Icon type=\"ios-trash-outline\" @click.native=\"handleRemoveImg(item)\"></Icon>\n                    </div>\n                  </template>\n                  <template v-else>\n                    <Progress v-if=\"item.showProgress\" :percent=\"item.percentage\" hide-info></Progress>\n                  </template>\n                </div>\n                <Upload\n                  ref=\"upload\"\n                  :show-upload-list=\"false\"\n                  :default-file-list=\"defaultList\"\n                  :format=\"['jpg','jpeg','png']\"\n                  :max-size=\"2048\"\n                  :on-success=\"handleSuccess\"\n                  :on-format-error=\"handleFormatError\"\n                  :on-exceeded-size=\"handleMaxSize\"\n                  :before-upload=\"handleBeforeUpload\"\n                  type=\"drag\"\n                  action=\"//jsonplaceholder.typicode.com/posts/\"\n                  style=\"display: inline-block;width:58px;\">\n                  <div style=\"width: 58px;height:58px;line-height: 58px;\">\n                    <Icon type=\"ios-camera\" size=\"20\"></Icon>\n                  </div>\n                </Upload>\n              </FormItem>\n              <FormItem label=\"AppId\">\n                <Input disabled v-model=\"formItem.appId\" placeholder=\"请输入内容\" />\n              </FormItem>\n              <FormItem label=\"开发者\">\n                <Select v-model=\"formItem.developerId\" filterable clearable>\n                  <Option\n                    :title=\"item.userName\"\n                    v-for=\"(item, index) in selectUsers\"\n                    @click.native=\"handleOnSelectUser(item)\"\n                    :value=\"item.userId\"\n                    :label=\"item.userName\"\n                    :key=\"index\"\n                  >\n                    <span>{{ item.userName }}</span>\n                  </Option>\n                </Select>\n              </FormItem>\n              <FormItem label=\"应用名称\" prop=\"appName\">\n                <Input v-model=\"formItem.appName\" placeholder=\"请输入内容\" />\n              </FormItem>\n              <FormItem label=\"英文名称\" prop=\"appNameEn\">\n                <Input v-model=\"formItem.appNameEn\" placeholder=\"请输入内容\" />\n              </FormItem>\n              <FormItem label=\"应用类型\" prop=\"appType\">\n                <Select v-model=\"formItem.appType\" @on-change=\"handleOnAppTypeChange\">\n                  <Option value=\"server\">服务器应用</Option>\n                  <Option value=\"app\">手机应用</Option>\n                  <Option value=\"pc\">PC网页应用</Option>\n                  <Option value=\"wap\">手机网页应用</Option>\n                </Select>\n              </FormItem>\n              <FormItem v-if=\"formItem.appType === 'app'\" prop=\"appOs\" label=\"操作系统\">\n                <RadioGroup v-model=\"formItem.appOs\">\n                  <Radio label=\"ios\">\n                    <Icon type=\"logo-apple\"></Icon>\n                    <span>苹果IOS</span>\n                  </Radio>\n                  <Radio label=\"android\">\n                    <Icon type=\"logo-android\"></Icon>\n                    <span>安卓Android</span>\n                  </Radio>\n                </RadioGroup>\n              </FormItem>\n              <FormItem label=\"应用官网\" prop=\"website\">\n                <Input v-model=\"formItem.website\" placeholder=\"请输入内容\" />\n              </FormItem>\n              <FormItem label=\"状态\">\n                <RadioGroup v-model=\"formItem.status\" type=\"button\">\n                  <Radio label=\"0\">下线</Radio>\n                  <Radio label=\"1\">上线</Radio>\n                </RadioGroup>\n              </FormItem>\n              <FormItem label=\"描述\">\n                <Input v-model=\"formItem.appDesc\" type=\"textarea\" placeholder=\"请输入内容\" />\n              </FormItem>\n            </Form>\n          </TabPane>\n          <TabPane :disabled=\"!formItem.appId\" label=\"开发信息\" name=\"form2\">\n            <Form ref=\"form2\" v-show=\"current=='form2'\" :model=\"formItem\" :rules=\"formItemRules\" :label-width=\"135\">\n              <FormItem label=\"ApiKey\">\n                <Input disabled v-model=\"formItem.apiKey\" placeholder=\"请输入内容\" />\n              </FormItem>\n              <FormItem label=\"SecretKey\">\n                <Input disabled v-model=\"formItem.secretKey\" placeholder=\"请输入内容\" />\n              </FormItem>\n              <FormItem label=\"授权类型\" prop=\"grantTypes\">\n                <CheckboxGroup v-model=\"formItem.grantTypes\">\n                  <Tooltip :content=\"item.desc\" v-for=\"(item, index) in selectGrantTypes\" :key=\"index\">\n                    <Checkbox :label=\"item.label\"><span>{{ item.title }}</span></Checkbox>\n                  </Tooltip>\n                </CheckboxGroup>\n              </FormItem>\n              <FormItem label=\"用户授权范围\" prop=\"scopes\">\n            <span slot=\"label\">用户授权范围\n            <Tooltip content=\"提醒用户确认授权可访问的资源\">\n              <Icon type=\"ios-alert\" size=\"16\"/>\n            </Tooltip>\n            </span>\n                <CheckboxGroup v-model=\"formItem.scopes\">\n                  <Checkbox v-for=\"(item, index) in selectScopes\" :key=\"index\" :label=\"item.label\"><span>{{ item.title }}</span>\n                  </Checkbox>\n                </CheckboxGroup>\n              </FormItem>\n              <FormItem label=\"自动授权范围\">\n            <span slot=\"label\">自动授权范围\n              <Tooltip content=\"不再提醒用户确认授权可访问的资源\">\n              <Icon type=\"ios-alert\" size=\"16\"/>\n            </Tooltip>\n            </span>\n                <CheckboxGroup v-model=\"formItem.autoApproveScopes\">\n                  <Checkbox v-for=\"(item, index) in selectScopes\" :key=\"index\" :label=\"item.label\"><span>{{ item.title }}</span>\n                  </Checkbox>\n                </CheckboxGroup>\n              </FormItem>\n              <FormItem label=\"令牌有效期\" prop=\"accessTokenValidity\">\n                <RadioGroup v-model=\"formItem.tokenValidity\" type=\"button\">\n                  <Radio label=\"1\">设置有效期</Radio>\n                  <Radio label=\"0\">不限制</Radio>\n                </RadioGroup>\n              </FormItem>\n              <FormItem v-show=\"formItem.tokenValidity === '1'\" label=\"访问令牌有效期\" prop=\"accessTokenValidity\">\n                <InputNumber :min=\"900\" v-model=\"formItem.accessTokenValidity\"></InputNumber>\n                <span>&nbsp;&nbsp;秒</span>\n              </FormItem>\n              <FormItem v-show=\"formItem.tokenValidity === '1'\" label=\"刷新令牌有效期\" prop=\"refreshTokenValidity\">\n                <InputNumber :min=\"900\" v-model=\"formItem.refreshTokenValidity\"></InputNumber>\n                <span>&nbsp;&nbsp;秒</span>\n              </FormItem>\n              <FormItem label=\"第三方登陆回调地址\" prop=\"redirectUrls\">\n                <Input v-model=\"formItem.redirectUrls\" type=\"textarea\" placeholder=\"请输入内容\" />\n                <span>多个地址使用,逗号隔开</span>\n              </FormItem>\n            </Form>\n          </TabPane>\n          <TabPane :disabled=\"!formItem.appId\" label=\"分配权限\" name=\"form3\">\n            <Form ref=\"form3\" v-show=\"current=='form3'\" :model=\"formItem\"  :label-width=\"100\" :rules=\"formItemRules\">\n              <FormItem prop=\"expireTime\" label=\"过期时间\">\n                <Badge v-if=\"formItem.isExpired\" text=\"授权已过期\">\n                  <DatePicker v-model=\"formItem.expireTime\" class=\"ivu-form-item-error\" type=\"datetime\"\n                              placeholder=\"授权有效期\"></DatePicker>\n                </Badge>\n                <DatePicker v-else=\"\" v-model=\"formItem.expireTime\" type=\"datetime\" placeholder=\"设置有效期\"></DatePicker>\n              </FormItem>\n              <FormItem prop=\"authorities\" label=\"功能接口\" >\n                <Transfer\n                  :data=\"selectApis\"\n                  :list-style=\"{width: '45%',height: '480px'}\"\n                  :titles=\"['选择接口', '已选择接口']\"\n                  :render-format=\"transferRender\"\n                  :target-keys=\"formItem.authorities\"\n                  @on-change=\"handleTransferChange\"\n                  filterable>\n                </Transfer>\n              </FormItem>\n            </Form>\n          </TabPane>\n        </Tabs>\n        <div class=\"drawer-footer\">\n          <Button type=\"default\" @click=\"handleReset\">取消</Button>&nbsp;\n          <Button type=\"primary\" @click=\"handleSubmit\" :loading=\"saving\">保存</Button>\n        </div>\n      </div>\n    </Modal>\n  </div>\n</template>\n\n<script>\n  //import {getApps, updateApp, addApp, removeApp, getAppClientInfo, updateAppClientInfo, restApp} from '@/api/app'\n \n  import {startWith, listConvertGroup} from '@/libs/util'\n  \n\n  export default {\n    name: 'SystemApp',\n    data () {\n      const validateEn = (rule, value, callback) => {\n        let reg = /^[-_a-zA-Z0-9]+$/\n        if (value === '') {\n          callback(new Error('英文不能为空'))\n        } else if (value !== '' && !reg.test(value)) {\n          callback(new Error('只允许字母、数字、下划线、横线'))\n        } else {\n          callback()\n        }\n      }\n      return {\n        loading: false,\n        saving: false,\n        current: 'form1',\n        forms: [\n          'form1',\n          'form2',\n          'form3'\n        ],\n        selectApis: [],\n        selectUsers: [],\n        selectGrantTypes: [\n          {label: 'authorization_code', title: '授权码模式', desc: 'Web服务端应用与第三方移动App应用'},\n          {label: 'client_credentials', title: '客户端模式', desc: '没有用户参与的,内部服务端与第三方服务端'},\n          {label: 'password', title: '密码模式', desc: '内部Web网页应用与内部移动App应用'},\n          {label: 'implicit', title: '简化模式', desc: 'Web网页应用或第三方移动App应用'},\n          {label: 'refresh_token', title: '刷新令牌', desc: '刷新并延迟访问令牌时长'},\n        ],\n        selectScopes: [\n          {label: 'userProfile', title: '允许访问基本信息'},\n          // 这是测试数据,自定义对应接口权限标识\n          {label: 'api1', title: '允许访问....自定义信息'},\n        ],\n        pageInfo: {\n          total: 0,\n          page: 1,\n          limit: 10,\n          appId: '',\n          appName: '',\n          appNameEn: ''\n        },\n        defaultList: [\n          {\n            'name': '',\n            'url': ''\n          }\n        ],\n        modalVisible: false,\n        modalTitle: '',\n        imgName: '',\n        visible: false,\n        uploadList: [],\n        formItemRules: {\n          website: [\n            {type: 'url', message: '请输入有效网址', trigger: 'blur'}\n          ],\n          appType: [\n            {required: true, message: '应用类型不能为空', trigger: 'blur'}\n          ],\n          appOs: [\n            {required: true, message: '操作系统不能为空', trigger: 'blur'}\n          ],\n          redirectUrls: [\n            {required: true, message: '授权重定向地址不能为空', trigger: 'blur'}\n          ],\n          appName: [\n            {required: true, message: '应用名称不能为空', trigger: 'blur'}\n          ],\n          appNameEn: [\n            {required: true, validator: validateEn, trigger: 'blur'}\n          ],\n          grantTypes: [\n            {required: true, type: 'array', min: 1, message: '授权类型不能为空', trigger: 'blur'}\n          ],\n          scopes: [\n            {required: true, type: 'array', min: 1, message: '用户授权范围不能为空', trigger: 'blur'}\n          ],\n          accessTokenValidity: [\n            {required: true, type: 'integer', min: 900, message: '访问令牌有效期不能少于900', trigger: 'blur'}\n          ],\n          refreshTokenValidity: [\n            {required: true, type: 'integer', min: 900, message: '刷新令牌有效期不能少于900', trigger: 'blur'}\n          ],\n        },\n        formItem: {\n          appId: '',\n          apiKey: '',\n          secretKey: '',\n          appName: '',\n          appNameEn: '',\n          appType: 'server',\n          appIcon: '',\n          appOs: '',\n          path: '',\n          website: '',\n          appDesc: '',\n          status: 1,\n          redirectUrls: '',\n          developerId: '',\n          scopes: ['userProfile'],\n          autoApproveScopes: [],\n          authorities: [],\n          grantTypes: [],\n          accessTokenValidity: 43200,\n          refreshTokenValidity: 2592000,\n          expireTime: '',\n          isExpired: false,\n          tokenValidity: '1'\n        },\n        columns: [\n          {\n            type: 'selection',\n            width: 60,\n            align: 'center'\n          },\n          {\n            title: '应用名称',\n            key: 'appName',\n            width: 200\n          },\n          {\n            title: 'AppId',\n            key: 'appId',\n            width: 200\n          },\n          {\n            title: 'ApiKey',\n            key: 'apiKey',\n            width: 250\n          },\n          {\n            title: 'SecretKey',\n            key: 'secretKey',\n            width: 300\n          },\n          {\n            title: '开发者',\n            key: 'userName',\n            width: 200\n          },\n          {\n            title: '应用类型',\n            slot: 'appType',\n            width: 180,\n            filters: [\n              {\n                label: '服务器应用',\n                value: 0\n              },\n              {\n                label: '手机应用',\n                value: 1\n              },\n              {\n                label: 'PC网页应用',\n                value: 2\n              },\n              {\n                label: '手机网页应用',\n                value: 3\n              }\n            ],\n            filterMultiple: false,\n            filterMethod (value, row) {\n              if (value === 0) {\n                return row.appType === 'server'\n              } else if (value === 1) {\n                return row.appType === 'app'\n              } else if (value === 2) {\n                return row.appType === 'pc'\n              } else if (value === 3) {\n                return row.appType === 'wap'\n              }\n            }\n          },\n          {\n            title: '状态',\n            slot: 'status',\n            key: 'status'\n          },\n          {\n            title: '操作',\n            slot: 'action',\n            fixed: 'right',\n            width: 120\n          }\n        ],\n        data: []\n      }\n    },\n    methods: {\n      handleModal (data) {\n        if (data) {\n          this.formItem = Object.assign({}, this.formItem, data)\n          this.formItem.appId = data.appId\n        }\n        if (this.current === this.forms[0]) {\n          this.modalTitle = data ? '编辑应用 - ' + data.appName : '添加应用'\n          this.handleLoadUsers()\n        }\n        if (this.current === this.forms[1]) {\n          this.modalTitle = data ? '开发信息 - ' + data.appName : '开发信息'\n          this.handleLoadAppClientInfo(this.formItem.apiKey)\n        }\n        if (this.current === this.forms[2]) {\n          this.modalTitle = data ? '分配权限 - ' + data.appName : '分配权限'\n          this.handleLoadAppGranted(this.formItem.appId)\n        }\n        this.formItem.status = this.formItem.status + ''\n      },\n      handleResetForm (form) {\n        this.$refs[form].resetFields()\n      },\n      handleReset () {\n        //重置验证\n        const newData = {\n          appId: '',\n          apiKey: '',\n          secretKey: '',\n          appName: '',\n          appNameEn: '',\n          appType: 'server',\n          appIcon: '',\n          appOs: '',\n          path: '',\n          website: '',\n          appDesc: '',\n          status: 1,\n          redirectUrls: '',\n          developerId: '',\n          scopes: ['userProfile'],\n          autoApproveScopes: [],\n          authorities: [],\n          grantTypes: [],\n          accessTokenValidity: 43200,\n          refreshTokenValidity: 2592000,\n          expireTime: '',\n          isExpired: false,\n          tokenValidity: '1'\n        }\n        this.formItem = newData\n        this.forms.map(form => {\n          this.handleResetForm(form)\n        })\n        this.current = this.forms[0]\n        this.saving = false\n        this.modalVisible = false\n      },\n      handleSubmit () {\n        if (this.current === this.forms[0]) {\n          this.$refs[this.current].validate((valid) => {\n            if (valid) {\n              this.saving = true\n              const data = Object.assign({}, this.formItem)\n              if (data.appId) {\n                \n              } else {\n                \n              }\n            }\n          })\n        }\n\n        if (this.current === this.forms[1]) {\n          this.$refs[this.current].validate((valid) => {\n            if (valid) {\n              this.saving = true\n              if (this.formItem.tokenValidity === '0') {\n                this.formItem.accessTokenValidity = -1\n                this.formItem.refreshTokenValidity = -1\n              }\n              \n            }\n          })\n        }\n\n        if (this.current === this.forms[2]) {\n          this.$refs[this.current].validate((valid) => {\n            if (valid) {\n              this.saving = true\n              \n            }\n          })\n        }\n      },\n      handleSearch(page) {\n        if (page) {\n          this.pageInfo.page = page\n        }\n        this.loading = true\n        \n      },\n      handleRemove (data) {\n        this.$Modal.confirm({\n          title: '删除后将无法恢复,确定删除吗？',\n          onOk: () => {\n          }\n        })\n      },\n      handleResetSecret (data) {\n        this.$Modal.confirm({\n          title: '重置后将影响应用正常使用,确定重置吗？',\n          onOk: () => {\n          }\n        })\n      },\n      handleTabClick(name){\n        this.current = name\n        this.handleModal();\n      },\n      handleClick (name, row) {\n        switch (name) {\n          case 'remove':\n            this.handleRemove(row)\n            break\n          case 'resetSecret':\n            this.handleResetSecret(row)\n            break\n        }\n      },\n      handleOnAppTypeChange (data) {\n        if (data !== 'app') {\n          this.formItem.appOs = ''\n        } else {\n          if (!this.formItem.appOs) {\n            this.formItem.appOs = 'ios'\n          }\n        }\n      },\n      handleOnSelectUser (data) {\n        this.formItem.developerId = data.userId\n      },\n      handlePage (current) {\n        this.pageInfo.page = current\n        this.handleSearch()\n      }\n      ,\n      handlePageSize (size) {\n        this.pageInfo.limit = size\n        this.handleSearch()\n      },\n      handleLoadAppGranted (appId) {\n        if (!appId) {\n          return\n        }\n        const that = this\n        const p1 = getAuthorityApi('')\n        const p2 = getAuthorityApp(appId)\n        \n      },\n      handleLoadAppClientInfo (clientId) {\n        if (!clientId) {\n          return\n        }\n        \n      },\n      transferRender (item) {\n        return `<span  title=\"${item.label}\">${item.label}</span>`\n      },\n      handleTransferChange (newTargetKeys, direction, moveKeys) {\n        if (newTargetKeys.indexOf('1') != -1) {\n          this.formItem.authorities = ['1']\n        } else {\n          this.formItem.authorities = newTargetKeys\n        }\n      },\n      handleLoadUsers () {\n        \n      },\n      handleView (name) {\n        this.imgName = name\n        this.visible = true\n      }\n      ,\n      handleRemoveImg (file) {\n        const fileList = this.$refs.upload.fileList\n        this.$refs.upload.fileList.splice(fileList.indexOf(file), 1)\n      }\n      ,\n      handleSuccess (res, file) {\n        file.url = ''\n        file.name = ''\n      }\n      ,\n      handleFormatError (file) {\n        this.$Message.warning('图片支持png、jpg、jpeg')\n      }\n      ,\n      handleMaxSize (file) {\n        this.$Message.warning('图片大小不能超过2M.')\n      }\n      ,\n      handleBeforeUpload () {\n        const check = this.uploadList.length < 1\n        if (!check) {\n          this.$Message.warning('只能上传一张.')\n        }\n        return check\n      }\n    },\n    mounted: function () {\n      this.handleSearch()\n    }\n  }\n</script>\n<style scoped>\n  .upload-list {\n    display: inline-block;\n    width: 60px;\n    height: 60px;\n    text-align: center;\n    line-height: 60px;\n    border: 1px solid transparent;\n    border-radius: 4px;\n    overflow: hidden;\n    background: #fff;\n    position: relative;\n    box-shadow: 0 1px 1px rgba(0, 0, 0, .2);\n    margin-right: 4px;\n  }\n\n  .upload-list img {\n    width: 100%;\n    height: 100%;\n  }\n\n  .upload-list-cover {\n    display: none;\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    background: rgba(0, 0, 0, .6);\n  }\n\n  .upload-list:hover .upload-list-cover {\n    display: block;\n  }\n\n  .upload-list-cover i {\n    color: #fff;\n    font-size: 20px;\n    cursor: pointer;\n    margin: 0 2px;\n  }\n</style>\n"],"sourceRoot":"src/view/module/system/app"}]}