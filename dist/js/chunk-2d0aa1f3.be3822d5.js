(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0aa1f3"],{1053:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Card",[a("Form",{ref:"searchForm",attrs:{model:e.pageInfo,inline:"","label-width":80}},[a("FormItem",{attrs:{label:"公司名称",prop:"fullName"}},[a("Input",{attrs:{type:"text",placeholder:"请输入关键字"},model:{value:e.pageInfo.fullName,callback:function(t){e.$set(e.pageInfo,"fullName",t)},expression:"pageInfo.fullName"}})],1),a("FormItem",{attrs:{label:"创建人",prop:"createUse"}},[a("Input",{attrs:{type:"text",placeholder:"请输入关键字"},model:{value:e.pageInfo.createUse,callback:function(t){e.$set(e.pageInfo,"createUse",t)},expression:"pageInfo.createUse"}})],1),a("FormItem",[a("Button",{attrs:{type:"primary"},on:{click:function(t){return e.handleSearch(1)}}},[e._v("查询")]),e._v(" \n        "),a("Button",{on:{click:function(t){return e.handleResetForm("searchForm")}}},[e._v("重置")])],1)],1),a("div",{staticClass:"search-con search-con-top"},[a("ButtonGroup",[a("Button",{attrs:{type:"primary"},on:{click:function(t){return e.handleModal()}}},[a("span",[e._v("添加")])])],1)],1),a("Table",{attrs:{border:"",columns:e.columns,data:e.data,loading:e.loading},scopedSlots:e._u([{key:"status",fn:function(e){var t=e.row;return[1===t.status?a("Badge",{attrs:{status:"success",text:"正常"}}):2===t.status?a("Badge",{attrs:{status:"warning",text:"锁定"}}):a("Badge",{attrs:{status:"error",text:"禁用"}})]}},{key:"action",fn:function(t){var r=t.row;return[a("a",{attrs:{disabled:!e.hasAuthority("systemUserEdit")},on:{click:function(t){return e.handleModal(r)}}},[e._v("编辑")]),e._v(" \n        "),a("Dropdown",{directives:[{name:"show",rawName:"v-show",value:e.hasAuthority("systemUserEdit"),expression:"hasAuthority('systemUserEdit')"}],ref:"dropdown",attrs:{transfer:""},on:{"on-click":function(t){return e.handleClick(t,r)}}},[a("a",{attrs:{href:"javascript:void(0)"}},[a("span",[e._v("更多")]),a("Icon",{attrs:{type:"ios-arrow-down"}})],1),a("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[a("DropdownItem",{attrs:{name:"sendToEmail"}},[e._v("发送到密保邮箱")])],1)],1),e._v(" \n      ")]}}])}),a("Page",{attrs:{transfer:"",total:e.pageInfo.total,current:e.pageInfo.page,"page-size":e.pageInfo.limit,"show-elevator":"","show-sizer":"","show-total":""},on:{"on-change":e.handlePage,"on-page-size-change":e.handlePageSize}})],1),a("Modal",{attrs:{title:e.modalTitle,width:"40"},on:{"on-cancel":e.handleReset},model:{value:e.modalVisible,callback:function(t){e.modalVisible=t},expression:"modalVisible"}},[a("div",[a("Form",{directives:[{name:"show",rawName:"v-show",value:"form1"==e.current,expression:"current == 'form1'"}],ref:"form1",attrs:{model:e.formItem,rules:e.formItemRules,"label-width":100}},[a("FormItem",{attrs:{label:"公司类型",prop:"userType"}},[a("RadioGroup",{model:{value:e.formItem.userType,callback:function(t){e.$set(e.formItem,"userType",t)},expression:"formItem.userType"}},[a("Radio",{attrs:{label:"super"}},[e._v("民企")]),a("Radio",{attrs:{label:"normal"}},[e._v("国企")])],1)],1),a("FormItem",{attrs:{label:"公司全称",prop:"nickName"}},[a("Input",{attrs:{placeholder:"请输入内容"},model:{value:e.formItem.nickName,callback:function(t){e.$set(e.formItem,"nickName",t)},expression:"formItem.nickName"}})],1),a("FormItem",{attrs:{label:"公司简称",prop:"userName"}},[a("Input",{attrs:{disabled:!!e.formItem.userId,placeholder:"请输入内容"},model:{value:e.formItem.userName,callback:function(t){e.$set(e.formItem,"userName",t)},expression:"formItem.userName"}})],1),a("FormItem",{attrs:{label:"公司人数",prop:"number"}},[a("Input",{attrs:{type:"number",placeholder:"请输入内容"},model:{value:e.formItem.number,callback:function(t){e.$set(e.formItem,"number",t)},expression:"formItem.number"}})],1),a("FormItem",{attrs:{label:"创建人",prop:"passwordConfirm"}},[a("Input",{attrs:{type:"text",placeholder:"请输入创建人"},model:{value:e.formItem.passwordConfirm,callback:function(t){e.$set(e.formItem,"passwordConfirm",t)},expression:"formItem.passwordConfirm"}})],1),a("FormItem",{attrs:{label:"邮箱",prop:"email"}},[a("Input",{attrs:{placeholder:"请输入内容"},model:{value:e.formItem.email,callback:function(t){e.$set(e.formItem,"email",t)},expression:"formItem.email"}})],1),a("FormItem",{attrs:{label:"状态"}},[a("RadioGroup",{attrs:{type:"button"},model:{value:e.formItem.status,callback:function(t){e.$set(e.formItem,"status",t)},expression:"formItem.status"}},[a("Radio",{attrs:{label:"0"}},[e._v("禁用")]),a("Radio",{attrs:{label:"1"}},[e._v("正常")]),a("Radio",{attrs:{label:"2"}},[e._v("锁定")])],1)],1),a("FormItem",{attrs:{label:"描述"}},[a("Input",{attrs:{type:"textarea",placeholder:"请输入内容"},model:{value:e.formItem.userDesc,callback:function(t){e.$set(e.formItem,"userDesc",t)},expression:"formItem.userDesc"}})],1)],1),a("div",{staticClass:"drawer-footer"},[a("Button",{attrs:{type:"default"},on:{click:e.handleReset}},[e._v("取消")]),e._v(" \n        "),a("Button",{attrs:{type:"primary",loading:e.saving},on:{click:e.handleSubmit}},[e._v("保存")])],1)],1)])],1)},s=[],o=a("c276"),i=a("6b6c");const n=e=>i["a"].get("company",e);var l={name:"SystemUser",data(){const e=(e,t,a)=>{let r=/^[_a-zA-Z0-9]+$/,s=/^.{4,18}$/;""===t?a(new Error("登录名不能为空")):""===t||r.test(t)?""===t||s.test(t)?a():a(new Error("长度6到18个字符")):a(new Error("只允许字母、数字、下划线"))},t=(e,t,a)=>{let r=/^.{6,18}$/;""===t?a(new Error("请输入密码")):t!==this.formItem.password?a(new Error("两次输入密码不一致")):""===t||r.test(t)?a():a(new Error("长度6到18个字符"))},a=(e,t,a)=>{""===t?a(new Error("请再次输入密码")):t!==this.formItem.password?a(new Error("两次输入密码不一致")):a()},r=(e,t,a)=>{let r=/^1\d{10}$/;""===t||r.test(t)?a():a(new Error("手机号码格式不正确"))};return{loading:!1,saving:!1,modalVisible:!1,modalTitle:"",current:"form1",forms:["form1"],selectMenus:[],selectRoles:[],pageInfo:{page:1,pageSize:10,sort:"createTime",order:"desc"},formItemRules:{userType:[{required:!0,message:"用户类型不能为空",trigger:"blur"}],userName:[{required:!0,message:"用户名不能为空",trigger:"blur"},{required:!0,validator:e,trigger:"blur"}],password:[{required:!0,validator:t,trigger:"blur"}],passwordConfirm:[{required:!0,validator:a,trigger:"blur"}],nickName:[{required:!0,message:"昵称不能为空",trigger:"blur"}],email:[{required:!1,type:"email",message:"邮箱格式不正确",trigger:"blur"}],mobile:[{validator:r,trigger:"blur"}]},formItem:{userId:"",userName:"",nickName:"",password:"",passwordConfirm:"",status:1,companyId:"",email:"",mobile:"",userType:"normal",userDesc:"",avatar:"",grantRoles:[],grantActions:[],grantMenus:[],expireTime:"",isExpired:!1},columns:[{type:"selection",width:60},{title:"公司全称",key:"fullName"},{title:"公司简称",key:"simpleName"},{title:"邮箱",key:"email"},{title:"创建人",key:"createUser"},{title:"公司类型",key:"deptType"},{title:"更新时间",key:"updateTime"},{title:"操作人",key:"updateUser"},{title:"操作",slot:"action",fixed:"right",width:150}],columns2:[{title:"菜单",key:"menuName",minWidth:"250px"},{title:"操作",type:"template",template:"operation",minWidth:"200px"}],data:[]}},methods:{handleModal(e){e&&(this.formItem=Object.assign({},this.formItem,e)),this.current===this.forms[0]&&(this.modalTitle=e?"编辑公司 - "+e.userName:"添加公司",this.modalVisible=!0),this.formItem.status=this.formItem.status+""},handleResetForm(e){},handleReset(){const e={userId:"",userName:"",nickName:"",password:"",passwordConfirm:"",status:1,companyId:"",email:"",mobile:"",userType:"normal",userDesc:"",avatar:"",grantRoles:[],grantMenus:[],grantActions:[],expireTime:"",isExpired:!1};this.formItem=e,this.forms.map(e=>{this.handleResetForm(e)}),this.current=this.forms[0],this.formItem.grantMenus=[],this.formItem.grantActions=[],this.modalVisible=!1,this.saving=!1},handleSubmit(){this.current===this.forms[0]&&this.$refs[this.current].validate(e=>{e&&(this.saving=!0,this.formItem.userId?updateUser(this.formItem).then(e=>{0===e.code&&(this.$Message.success("保存成功"),this.handleReset()),this.handleSearch()}).finally(()=>{this.saving=!1}):addUser(this.formItem).then(e=>{0===e.code&&(this.$Message.success("保存成功"),this.handleReset()),this.handleSearch()}).finally(()=>{this.saving=!1}))})},handleSearch(e){e&&(this.pageInfo.page=e),this.loading=!0,getUsers(this.pageInfo).then(e=>{this.data=e.data.records,this.pageInfo.total=parseInt(e.data.total)}).finally(()=>{this.loading=!1})},getCheckedAuthorities(){const e=this.$refs["tree"].getCheckedProp("authorityId");return e.concat(this.formItem.grantActions)},handleLoadUserGranted(e){const t=this,a=getAuthorityUser(e),r=[];Promise.all([p1,a]).then((function(e){let a=e[0],s=e[1];if(0===a.code&&a.data){let e={primaryKey:"menuId",parentKey:"parentId",startPid:"0"};if(0===s.code&&s.data&&s.data.length>0){let e=[],a=[];s.data.map(t=>{"role"===t.owner&&r.push(t.authorityId),-1==t.authority.indexOf("MENU_")||e.includes(t.authorityId)||e.push(t.authorityId),-1==t.authority.indexOf("ACTION_")||a.includes(t.authorityId)||a.push(t.authorityId)}),t.formItem.grantMenus=e,t.formItem.grantActions=a,s.data.length>0&&(t.formItem.expireTime=s.data[0].expireTime,t.formItem.isExpired=s.data[0].isExpired)}a.data.map(e=>{t.formItem.grantMenus.includes(e.authorityId)&&(e._isChecked=!0,r.includes(e.authorityId)&&(e.disabled=!0,e.menuName+=" (禁止勾选)")),e.actionList.map(e=>{r.includes(e.authorityId)&&(e.disabled=!0)})}),t.selectMenus=Object(o["j"])(a.data,e)}t.modalVisible=!0}))},handleLoadRoles(e){if(!e)return;const t=this,a=getAllRoles(),r=getUserRoles(e);Promise.all([a,r]).then((function(e){let a=e[0],r=e[1];if(0===a.code&&(t.selectRoles=a.data),0===r.code){let e=[];r.data.map(t=>{e.push(t.roleId)}),t.formItem.grantRoles=e}t.modalVisible=!0}))},handlePage(e){this.pageInfo.page=e,this.handleSearch()},handlePageSize(e){this.pageInfo.limit=e,this.handleSearch()},handleClick(e,t){switch(e){case"sendToEmail":this.$Message.warning("发送至密保邮箱,开发中...");break}},handleTabClick(e){this.current=e,this.handleModal()},loadList(){n().then(e=>{console.log(e)})}},mounted:function(){}},m=l,d=a("4e82"),u=Object(d["a"])(m,r,s,!1,null,null,null);t["default"]=u.exports}}]);